function mozCatalogFilter(){this.catalogMaxChecksPerOptionFilter=20,this.initSort(),this.initFilter(),this.doUpdateFilteredProductsCount()}function reinitMozCatalogFilterActions(){new mozCatalogFilter}mozCatalogFilter.prototype.initSort=function(){var t=this;$("#cat-nav .cat-sort").off().on("change",(function(){t.doSortOrFilter("sort")}))},mozCatalogFilter.prototype.initFilter=function(){var t=this,e=$("#cat-filter");menuAddOpenerLogic("#cat-filter",$(".cat-filter-toggle")),$("#cat-filter-close").on("click",(function(){e.hide().removeClass("visible")})),loadInlineSvg(".cat-filter-toggle img, #cat-filter button img");var o=getElementColor($(".cat-filter-toggle div"),"color");setSlidingPanelColors(o),this.buildFilters(),$("#cat-filter-reset").off().on("click",(function(){t.resetCurrentFilterValues()})),this.toggleFilterResetVisibility()},mozCatalogFilter.prototype.toggleFilterResetVisibility=function(){var t=this.getCurrentFilterValues();$("#cat-filter-reset").toggle(Array.isArray(t)&&t.length>0)},mozCatalogFilter.prototype.buildFilters=function(){var t=this,e=$("#cat-filter-base");1==e.length&&null!=typeof mozCatFilters&&(e.find("form.moze-form").html(""),$.each(mozCatFilters.common,(function(o,a){var i="";"slider"==a.control&&(i=t._buildFilterSliderCtrl(a)),"checkboxes"==a.control&&(i=t._buildFilterCheckboxesCtrl(a,"common")),i&&(i.addClass("common"),e.find("form.moze-form").append(i))})),$.each(mozCatFilters.options,(function(o,a){var i="";if("checkboxes"==a.control&&(i=t._buildFilterCheckboxesCtrl(a,"options")),i){i.addClass("options"),e.find("form.moze-form").append(i);var r=i.find('input[type="checkbox"]').first();r.length&&t.doRestrictCheckboxesChecked(r)}})),t.countTotalFiltersSet())},mozCatalogFilter.prototype._buildFilterSliderCtrl=function(t){var e=this,o=$("<div>",{class:"cat-filter-group"}).attr("data-type",t.control).attr("data-name",t.name),a=$("<h3>").html(t.caption);o.append(a);var i=$("<div>",{class:"moze-filter-slider",style:"margin: 65px 14px 40px 14px"});return o.append(i),noUiSlider.create(i[0],{start:[t.value_min,t.value_max],connect:!0,step:1,tooltips:!0,range:{min:t.control_min,max:t.control_max},margin:t.control_max-t.control_min<=100?1:10}),i[0].noUiSlider.on("end",(function(){e.doSortOrFilter("filter")})),o},mozCatalogFilter.prototype._buildFilterCheckboxesCtrl=function(t,e){var o=this,a=$("<div>",{class:"cat-filter-group"}).attr("data-type",t.control).attr("data-name",t.name),i=$("<h3>").html(t.caption);return a.append(i),$.each(t.options,(function(t,i){var r=$("<label>",{class:"moze-checkbox"}),n=i.key?i.key:i.caption,l=$("<input>",{type:"checkbox",name:n,value:1,checked:1==i.value});l.on("click",(function(){o.doSortOrFilter("filter")})),"options"==e&&l.on("click",(function(){o.doRestrictCheckboxesChecked($(l))})),r.append(l),r.append(document.createTextNode(i.caption)),a.append(r),a.append($("<br>"))})),a},mozCatalogFilter.prototype.countTotalFiltersSet=function(){var t=0,e=$("#cat-filter-base .cat-filter-group");return t+=e.find('input[type="checkbox"]:checked').length,e.find(".moze-filter-slider").each((function(){var e=$(this)[0].noUiSlider;(e.get(!0)[0]>e.options.range.min||e.get(!0)[1]<e.options.range.max)&&t++})),t},mozCatalogFilter.prototype.getCurrentFilterValues=function(){var t=[];return $("#cat-filter-base .cat-filter-group").each((function(e,o){var a=$(this).attr("data-name"),i=$(this).attr("data-type"),r=$(this).hasClass("common")?"common":"options";switch(i){case"slider":var n=$(this).find(".moze-filter-slider");if(n.length)var l=n[0].noUiSlider.get(!0),c=n[0].noUiSlider.options,s=[l[0]>c.range.min?l[0]:null,l[1]<c.range.max?l[1]:null];else s=[null,null];s[0]&&t.push({key:a+"_min",value:Math.round(100*s[0])/100,source:r}),s[1]&&t.push({key:a+"_max",value:Math.round(100*s[1])/100,source:r});break;case"checkboxes":var h=$(this).find('input[type="checkbox"][name]');s=[];$.each(h,(function(){$(this).is(":checked")&&s.push($(this).attr("name"))})),s.length>0&&t.push({key:a,value:s,source:r})}})),t},mozCatalogFilter.prototype.resetCurrentFilterValues=function(){var t=!1;$("#cat-filter-base .cat-filter-group").each((function(e,o){$(this).attr("data-name");switch($(this).attr("data-type")){case"slider":var a=$(this).find(".moze-filter-slider");if(a.length){var i=a[0].noUiSlider.get(!0),r=a[0].noUiSlider.options,n=[i[0]>r.range.min?i[0]:null,i[1]<r.range.max?i[1]:null];(n[0]||n[1])&&(a[0].noUiSlider.set([r.range.min,r.range.max]),t=!0)}break;case"checkboxes":var l=$(this).find('input[type="checkbox"][name]');l.length&&$.each(l,(function(){$(this).is(":checked")&&($(this).prop("checked",!1),t=!0)}))}})),t&&this.doSortOrFilter("filter"),this.toggleFilterResetVisibility()},mozCatalogFilter.prototype.doUpdateFilteredProductsCount=function(){if(this.countTotalFiltersSet()>0){var t=$(".mz_component.mz_catalog .cat-grid .cat-thumb").length;$("#cat-nav .cat-filter-toggle .counter").show(),$("#cat-nav .cat-filter-toggle .counter span").html(t)}else $("#cat-nav .cat-filter-toggle .counter").hide(),$("#cat-nav .cat-filter-toggle .counter span").html("")},mozCatalogFilter.prototype.doRestrictCheckboxesChecked=function(t){var e=$(t).parents(".cat-filter-group.options");if(e.length){var o=e.find('input[type="checkbox"]:checked'),a=e.find('input[type="checkbox"]:not(:checked)');o.length>=this.catalogMaxChecksPerOptionFilter?a.attr("disabled",!0).attr("checked",!1):a.attr("disabled",!1)}},mozCatalogFilter.prototype.doSortOrFilter=function(t){var e=this,o=new URL(window.location),a=$("#cat-nav .cat-sort select option:selected").val(),i=this.getCurrentFilterValues();if("sort"==t&&o.searchParams.set("sort",a),"filter"==t){var r=[],n=[/(availability)|(price_min)|(price_max)|(brand)/,/o[0-9]+/,/v[0-9]+(\[\])?/];for(var l of o.searchParams.entries())for(var c of n)l[0].match(c)&&r.push(l[0]);for(var s of r)o.searchParams.delete(s);for(var l of i)if("options"!=l.source)if(Array.isArray(l.value))for(var h of l.value)o.searchParams.append(l.key+"[]",h);else o.searchParams.set(l.key,l.value);var u=1;for(var l of i)if("common"!=l.source){if(o.searchParams.set("o"+u,l.key),Array.isArray(l.value))for(var h of l.value)o.searchParams.append("v"+u+"[]",h);else o.searchParams.set("v"+u,l.value);u++}}new mozLive3({source:{name:"maincatalog",superglobal:1},action:"catalog-list-view-refresh",parameters:{host:o.host,pathname:o.pathname,search:o.search},response:{callback:[function(t){if(t.success){var a=(new DOMParser).parseFromString(t.html,"text/html"),i=$(a).find(".mz_component.mz_catalog").find(".cat-grid");$(".mz_component.mz_catalog .cat-grid").replaceWith(i),e.doUpdateFilteredProductsCount(),e.fixCatImages(),reinitMozCatalogCartActions(),e.toggleFilterResetVisibility(),window.history.replaceState({path:o.toString()},"",o.toString())}else window.location=o}]}})},mozCatalogFilter.prototype.fixThumbnailImageLayout=function(){"function"==typeof fixThumbnailImageLayout&&$('.mz_catalog .cat-thumb-pic img:not([data-slot-type="no-product"])').one("load",(function(){fixThumbnailImageLayout(this)})).each((function(){this.complete&&void 0!==$(this).attr("src")&&$(this).trigger("load")}))},mozCatalogFilter.prototype.fixCatImages=function(){"function"==typeof $.fn.unveil&&$(".cat-thumb-pic img").unveil(300),this.fixThumbnailImageLayout()},$(document).ready((function(){reinitMozCatalogFilterActions()}));